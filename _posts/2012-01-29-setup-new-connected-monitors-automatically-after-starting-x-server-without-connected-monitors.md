---
layout: post
title: "모니터 없이 X 서버 실행 후 나중에 모니터 연결해도 화면이 안보인다면"
tags: [ Linux,  Udev,  Xorg ]
---

제목이 조금 길지만, 이 글의 내용은 제목 그대로입니다. (참고로, 이 글은 최근 인텔 그래픽 칩셋을 대상으로 작성되었습니다. 즉, 다른 그래픽 칩셋 드라이버는 어떻게 동작하는지 확인을 안 해 보았다는 의미입니다)

요즘 X 서버는 연결된 모니터가 없고, `/etc/X11/xorg.conf` 파일에 수직/수평 주파수가 정의되어 있지 않다고 하더라도 일단 정상적으로 실행됩니다. 다만, 초기 해상도가 320x200 처럼 매우 작을 수 있습니다. 그런데 나중에 필요에 의해 모니터를 연결했는데 화면이 보이지 않는 경우가 발생합니다. 이 경우, 네트웍으로 접속해서 다음 명령어를 실행합니다.

```sh
$ export DISPLAY=:0.0
$ xrandr --auto
```

그러면 X 서버가 알아서 연결되어 있는 모니터를 출력으로 재설정하고 가장 선호하는(preferred) 해상도와 주파수를 선택합니다. 그런데 이를 자동으로 동작하게 하려면 udev 데몬의 도움을 받아야 합니다. 그래서 `/etc/udev/rules.d` 디렉토리에 확장자가 `'.rules'`인 파일을 생성하고 다음과 같이 내용을 채웁니다.

```sh
ACTION=="change", SUBSYSTEM=="drm", KERNEL=="card*", RUN+="/usr/bin/auto-xrandr.sh"
```

그리고 `/usr/bin/auto-xrandr.sh` 파일을 아래와 같이 작성한뒤 실행권한을 줍니다.

```sh
#!/bin/sh
[ "$DISPLAY" = "" ] && export DISPLAY=:0.0
xrandr --auto
xrandr --dpi 96
```

그러면 이제부터 모니터 연결시 자동으로 연결을 재설정하게 됩니다.

그런데, 만일 네트웍으로 접속했거나, udev 데몬에 의해 실행되는 경우 X 서버 인증이 안된 계정이라며 `xrandr` 명령이 실행이 거부됩니다. 이를 제대로 처리하려면 복잡한 인증 과정이 필요한데, 이를 쉽게 처리하려면 그냥 X 서버 시작할때 자동으로 실행되는 초기화 스크립트에 `'xhost +'` 명령어를 주면 인증을 무시하게 됩니다. 물론 보안상 좋은 방법은 아니지만, 폐쇠된 환경이라면 별로 문제가 없을 겁니다.

각각의 명령어에 대해 더 궁금하신 분은 관련 명령어 매뉴얼 페이지를 확인해 보시기 바랍니다.

참고로 조금만 더 설명하면, 노트북 외부 모니터 단자에 빔 프로젝트나 외부 모니터를 연결했을 경우도 xrandr 명령을 직접 사용하거나 지금까지 설명한 방법을 조금 다르게 응용할 수 있습니다.
